{"ast":null,"code":"var _this = this,\n    _jsxFileName = \"/home/teuteuf/workspace/web/react-pwa-install/src/index.js\";\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nimport React, { useState, useRef, useEffect, createContext, useContext } from \"react\";\nimport { platforms, getPlatform } from \"./Platforms\";\nimport InstallDialog from \"./InstallDialog\";\nvar ReactPWAInstallContext = createContext(Promise.reject);\nexport var useReactPWAInstall = function useReactPWAInstall() {\n  return useContext(ReactPWAInstallContext);\n};\nvar platform = getPlatform();\nexport var ReactPWAInstallProvider = function ReactPWAInstallProvider(_ref) {\n  var children = _ref.children,\n      enableLogging = _ref.enableLogging;\n  var awaitingPromiseRef = useRef();\n  var deferredprompt = useRef(null);\n\n  var _useState = useState(null),\n      dialogState = _useState[0],\n      setDialogState = _useState[1];\n\n  var _useState2 = useState({\n    supported: supported,\n    isInstalled: isInstalled,\n    pwaInstall: openDialog\n  }),\n      contextValue = _useState2[0],\n      setContextValue = _useState2[1];\n\n  useEffect(function () {\n    window.addEventListener(\"beforeinstallprompt\", handleBeforeInstallPromptEvent);\n    return function cleanup() {\n      window.removeEventListener(\"beforeinstallprompt\", handleBeforeInstallPromptEvent);\n    };\n  }, []);\n\n  function logger(message) {\n    if (enableLogging) {\n      console.log(message);\n    }\n  }\n\n  function isInstalled() {\n    if (window.navigator.standalone === true || window.matchMedia(\"(display-mode: standalone)\").matches) {\n      logger(\"isInstalled: true. Already in standalone mode\");\n      return true;\n    }\n\n    logger(\"isInstalled: false.\");\n    return false;\n  }\n\n  function supported() {\n    if (deferredprompt.current != null && platform === platforms.NATIVE) {\n      logger(\"supported: true - native platform\");\n      return true;\n    }\n\n    if (platform !== platforms.NATIVE && platform !== platforms.OTHER) {\n      logger(\"supported: true - manual support\");\n      return true;\n    }\n\n    logger(\"supported: false\");\n    return false;\n  }\n\n  function handleBeforeInstallPromptEvent(event) {\n    event.preventDefault();\n    deferredprompt.current = event;\n    logger(\"beforeinstallprompt event fired and captured\");\n    setContextValue({\n      supported: supported,\n      isInstalled: isInstalled,\n      pwaInstall: openDialog\n    });\n  }\n\n  function openDialog(options) {\n    setDialogState(options);\n    return new Promise(function (resolve, reject) {\n      awaitingPromiseRef.current = {\n        resolve: resolve,\n        reject: reject\n      };\n    });\n  }\n\n  function handleClose() {\n    setDialogState(null);\n\n    if (awaitingPromiseRef.current) {\n      awaitingPromiseRef.current.reject();\n    }\n  }\n\n  function handleInstall() {\n    logger(\"handleInstall called\");\n    setDialogState(null);\n\n    if (deferredprompt.current != null) {\n      return deferredprompt.current.prompt().then(function (event) {\n        return deferredprompt.current.userChoice;\n      }).then(function (choiceResult) {\n        if (choiceResult.outcome === \"accepted\") {\n          logger(\"PWA native installation succesful\");\n\n          if (awaitingPromiseRef.current) {\n            awaitingPromiseRef.current.resolve();\n          }\n        } else {\n          logger(\"User opted out by cancelling native installation\");\n\n          if (awaitingPromiseRef.current) {\n            awaitingPromiseRef.current.reject();\n          }\n        }\n      })[\"catch\"](function (err) {\n        if (awaitingPromiseRef.current) {\n          awaitingPromiseRef.current.resolve();\n        }\n\n        logger(\"Error occurred in the installing process: \", err);\n      });\n    } else {\n      if (awaitingPromiseRef.current) {\n        awaitingPromiseRef.current.resolve();\n      }\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ReactPWAInstallContext.Provider, {\n    value: contextValue,\n    children: children,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(InstallDialog, _extends({\n    open: Boolean(dialogState),\n    onSubmit: handleInstall,\n    onClose: handleClose,\n    platform: platform\n  }, dialogState, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }\n  })));\n};\nexport default ReactPWAInstallProvider;","map":{"version":3,"sources":["/Users/adammckenna/github-repos/worldle/node_modules/@teuteuf/react-pwa-install/es/index.js"],"names":["_this","_jsxFileName","_extends","Object","assign","target","i","arguments","length","source","key","prototype","hasOwnProperty","call","apply","React","useState","useRef","useEffect","createContext","useContext","platforms","getPlatform","InstallDialog","ReactPWAInstallContext","Promise","reject","useReactPWAInstall","platform","ReactPWAInstallProvider","_ref","children","enableLogging","awaitingPromiseRef","deferredprompt","_useState","dialogState","setDialogState","_useState2","supported","isInstalled","pwaInstall","openDialog","contextValue","setContextValue","window","addEventListener","handleBeforeInstallPromptEvent","cleanup","removeEventListener","logger","message","console","log","navigator","standalone","matchMedia","matches","current","NATIVE","OTHER","event","preventDefault","options","resolve","handleClose","handleInstall","prompt","then","userChoice","choiceResult","outcome","err","createElement","Fragment","Provider","value","__self","__source","fileName","lineNumber","columnNumber","open","Boolean","onSubmit","onClose"],"mappings":"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","sourcesContent":["var _this = this,\n    _jsxFileName = \"/home/teuteuf/workspace/web/react-pwa-install/src/index.js\";\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport React, { useState, useRef, useEffect, createContext, useContext } from \"react\";\nimport { platforms, getPlatform } from \"./Platforms\";\nimport InstallDialog from \"./InstallDialog\";\nvar ReactPWAInstallContext = createContext(Promise.reject);\nexport var useReactPWAInstall = function useReactPWAInstall() {\n  return useContext(ReactPWAInstallContext);\n};\nvar platform = getPlatform();\nexport var ReactPWAInstallProvider = function ReactPWAInstallProvider(_ref) {\n  var children = _ref.children,\n      enableLogging = _ref.enableLogging;\n  var awaitingPromiseRef = useRef();\n  var deferredprompt = useRef(null);\n\n  var _useState = useState(null),\n      dialogState = _useState[0],\n      setDialogState = _useState[1];\n\n  var _useState2 = useState({\n    supported: supported,\n    isInstalled: isInstalled,\n    pwaInstall: openDialog\n  }),\n      contextValue = _useState2[0],\n      setContextValue = _useState2[1];\n\n  useEffect(function () {\n    window.addEventListener(\"beforeinstallprompt\", handleBeforeInstallPromptEvent);\n    return function cleanup() {\n      window.removeEventListener(\"beforeinstallprompt\", handleBeforeInstallPromptEvent);\n    };\n  }, []);\n\n  function logger(message) {\n    if (enableLogging) {\n      console.log(message);\n    }\n  }\n\n  function isInstalled() {\n    if (window.navigator.standalone === true || window.matchMedia(\"(display-mode: standalone)\").matches) {\n      logger(\"isInstalled: true. Already in standalone mode\");\n      return true;\n    }\n\n    logger(\"isInstalled: false.\");\n    return false;\n  }\n\n  function supported() {\n    if (deferredprompt.current != null && platform === platforms.NATIVE) {\n      logger(\"supported: true - native platform\");\n      return true;\n    }\n\n    if (platform !== platforms.NATIVE && platform !== platforms.OTHER) {\n      logger(\"supported: true - manual support\");\n      return true;\n    }\n\n    logger(\"supported: false\");\n    return false;\n  }\n\n  function handleBeforeInstallPromptEvent(event) {\n    event.preventDefault();\n    deferredprompt.current = event;\n    logger(\"beforeinstallprompt event fired and captured\");\n    setContextValue({\n      supported: supported,\n      isInstalled: isInstalled,\n      pwaInstall: openDialog\n    });\n  }\n\n  function openDialog(options) {\n    setDialogState(options);\n    return new Promise(function (resolve, reject) {\n      awaitingPromiseRef.current = {\n        resolve: resolve,\n        reject: reject\n      };\n    });\n  }\n\n  function handleClose() {\n    setDialogState(null);\n\n    if (awaitingPromiseRef.current) {\n      awaitingPromiseRef.current.reject();\n    }\n  }\n\n  function handleInstall() {\n    logger(\"handleInstall called\");\n    setDialogState(null);\n\n    if (deferredprompt.current != null) {\n      return deferredprompt.current.prompt().then(function (event) {\n        return deferredprompt.current.userChoice;\n      }).then(function (choiceResult) {\n        if (choiceResult.outcome === \"accepted\") {\n          logger(\"PWA native installation succesful\");\n\n          if (awaitingPromiseRef.current) {\n            awaitingPromiseRef.current.resolve();\n          }\n        } else {\n          logger(\"User opted out by cancelling native installation\");\n\n          if (awaitingPromiseRef.current) {\n            awaitingPromiseRef.current.reject();\n          }\n        }\n      })[\"catch\"](function (err) {\n        if (awaitingPromiseRef.current) {\n          awaitingPromiseRef.current.resolve();\n        }\n\n        logger(\"Error occurred in the installing process: \", err);\n      });\n    } else {\n      if (awaitingPromiseRef.current) {\n        awaitingPromiseRef.current.resolve();\n      }\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(ReactPWAInstallContext.Provider, {\n    value: contextValue,\n    children: children,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(InstallDialog, _extends({\n    open: Boolean(dialogState),\n    onSubmit: handleInstall,\n    onClose: handleClose,\n    platform: platform\n  }, dialogState, {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 7\n    }\n  })));\n};\nexport default ReactPWAInstallProvider;"]},"metadata":{},"sourceType":"module"}